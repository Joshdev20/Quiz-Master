<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QuizMaster - Trivia Challenge</title>
  <!-- Tailwind CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <!-- FontAwesome CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86bU8zQ/3B3lX1aD2K3I6nH2g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* Custom styles for progress bar, animations, and skeleton loader */
    .progress-bar {
      transition: width 0.3s ease-in-out;
    }
    .animate-pulse-slow {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    .correct {
      background-color: #10b981 !important;
      color: white !important;
    }
    .incorrect {
      background-color: #ef4444 !important;
      color: white !important;
    }
    .skeleton {
      background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
      background-size: 200% 100%;
      animation: skeleton-gradient 2s linear infinite;
      border-radius: 0.5rem;
    }
    @keyframes skeleton-gradient {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    .modal {
      background: rgba(0, 0, 0, 0.75);
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 flex items-center justify-center min-h-screen font-sans">
  <div id="quiz-container" class="bg-gray-800 p-6 rounded-xl shadow-2xl max-w-lg w-full mx-4">
    <!-- Start Screen -->
    <div id="start-screen" class="text-center">
      <h1 class="text-4xl font-extrabold mb-6 bg-gradient-to-r from-blue-400 to-purple-500 text-transparent bg-clip-text">
        <i class="fas fa-brain mr-2"></i>QuizMaster
      </h1>
      <p class="text-gray-400 mb-6">Test your knowledge with our exciting trivia challenge! (Last updated: 11:51 PM WAT, June 23, 2025)</p>
      <div class="space-y-4">
        <div>
          <label for="category" class="block text-sm font-medium text-gray-300 mb-1">
            <i class="fas fa-list mr-2"></i>Category
          </label>
          <select id="category" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-gray-100 focus:ring-2 focus:ring-blue-500">
            <option value="9">General Knowledge</option>
            <option value="17">Science & Nature</option>
            <option value="23">History</option>
          </select>
        </div>
        <div>
          <label for="difficulty" class="block text-sm font-medium text-gray-300 mb-1">
            <i class="fas fa-tachometer-alt mr-2"></i>Difficulty
          </label>
          <select id="difficulty" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-gray-100 focus:ring-2 focus:ring-blue-500">
            <option value="">Any Difficulty</option>
            <option value="easy">Easy</option>
            <option value="medium">Medium</option>
            <option value="hard">Hard</option>
          </select>
        </div>
        <button id="start-btn" class="w-full bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition duration-300 animate-pulse-slow">
          <i class="fas fa-play mr-2"></i>Start Challenge
        </button>
      </div>
    </div>
    <!-- Quiz Screen -->
    <div id="quiz-screen" class="hidden">
      <!-- Loading Screen -->
      <div id="loading-screen">
        <div class="flex justify-center mb-4">
          <i class="fas fa-spinner fa-spin text-3xl text-blue-500"></i>
        </div>
        <div class="flex justify-between items-center mb-4">
          <div class="skeleton h-6 w-24"></div>
          <div class="skeleton h-6 w-16"></div>
        </div>
        <div class="skeleton h-2 w-full rounded-full mb-4"></div>
        <div class="skeleton h-8 w-3/4 mb-6"></div>
        <div class="space-y-3">
          <div class="skeleton h-10 w-full"></div>
          <div class="skeleton h-10 w-full"></div>
          <div class="skeleton h-10 w-full"></div>
          <div class="skeleton h-10 w-full"></div>
        </div>
        <div class="skeleton h-12 w-full mt-6"></div>
      </div>
      <!-- Quiz Content -->
      <div id="quiz-content" class="hidden">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-semibold">
            Question <span id="question-number"></span>/10
          </h2>
          <div class="text-lg flex items-center">
            <i class="fas fa-clock mr-2"></i><span id="timer">15</span>s
          </div>
        </div>
        <div class="w-full bg-gray-700 rounded-full h-2 mb-4">
          <div id="progress-bar" class="bg-blue-600 h-2 rounded-full progress-bar" style="width: 0%"></div>
        </div>
        <h3 id="question" class="text-lg font-medium mb-6"></h3>
        <div id="options" class="space-y-3"></div>
        <button id="submit-btn" class="w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 transition duration-300 mt-6">
          <i class="fas fa-check mr-2"></i>Submit Answer
        </button>
      </div>
    </div>
    <!-- Results Screen -->
    <div id="results-screen" class="hidden text-center">
      <h2 class="text-3xl font-bold mb-6">
        <i class="fas fa-trophy mr-2"></i>Results
      </h2>
      <p class="text-xl mb-6">Your Score: <span id="score">0</span>/10</p>
      <div id="leaderboard" class="mb-6 bg-gray-700 p-4 rounded-lg">
        <h3 class="text-lg font-semibold mb-2">Leaderboard</h3>
        <div id="leaderboard-content"></div>
        <div class="flex justify-between mt-4">
          <button id="prev-page" class="text-gray-400 hover:text-gray-100 disabled:opacity-50">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button id="next-page" class="text-gray-400 hover:text-gray-100 disabled:opacity-50">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
      <button id="review-btn" class="w-full bg-purple-600 text-white px-4 py-3 rounded-lg hover:bg-purple-700 transition duration-300 mb-4">
        <i class="fas fa-eye mr-2"></i>Review Answers
      </button>
      <button id="retry-btn" class="w-full bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition duration-300">
        <i class="fas fa-redo mr-2"></i>Retry Challenge
      </button>
    </div>
    <!-- Review Modal -->
    <div id="review-modal" class="hidden fixed inset-0 modal flex items-center justify-center z-50">
      <div class="bg-gray-800 p-6 rounded-xl shadow-2xl max-w-md w-full mx-4 h-full flex flex-col" style="max-height: 65vh;">
        <h3 class="text-2xl font-bold mb-4">
          <i class="fas fa-eye mr-2"></i>Answer Review
        </h3>
        <div id="review-content" class="space-y-4 p-4 flex-1">
          <!-- Content will be populated by JavaScript -->
        </div>
        <button id="close-review" class="w-full bg-gray-600 text-white px-4 py-3 rounded-lg hover:bg-gray-700 transition duration-300 mt-4">
          <i class="fas fa-times mr-2"></i>Close
        </button>
      </div>
    </div>
  </div>

  <script>
    // DOM Elements
    const startScreen = document.getElementById('start-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const resultsScreen = document.getElementById('results-screen');
    const loadingScreen = document.getElementById('loading-screen');
    const quizContent = document.getElementById('quiz-content');
    const reviewModal = document.getElementById('review-modal');
    const reviewContent = document.getElementById('review-content');
    const startBtn = document.getElementById('start-btn');
    const submitBtn = document.getElementById('submit-btn');
    const retryBtn = document.getElementById('retry-btn');
    const reviewBtn = document.getElementById('review-btn');
    const closeReview = document.getElementById('close-review');
    const questionNumber = document.getElementById('question-number');
    const questionText = document.getElementById('question');
    const optionsContainer = document.getElementById('options');
    const timerDisplay = document.getElementById('timer');
    const scoreDisplay = document.getElementById('score');
    const leaderboardContent = document.getElementById('leaderboard-content');
    const prevPage = document.getElementById('prev-page');
    const nextPage = document.getElementById('next-page');
    const progressBar = document.getElementById('progress-bar');
    const categorySelect = document.getElementById('category');
    const difficultySelect = document.getElementById('difficulty');

    let questions = [];
    let userAnswers = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let timer;
    let timeLeft = 15;
    let leaderboardPage = 0;
    const scoresPerPage = 3;

    // Fetch Questions from Open Trivia API
    async function fetchQuestions() {
      const category = categorySelect.value;
      const difficulty = difficultySelect.value;
      const url = `https://opentdb.com/api.php?amount=10&type=multiple&category=${category}${difficulty ? `&difficulty=${difficulty}` : ''}`;
      loadingScreen.classList.remove('hidden');
      quizContent.classList.add('hidden');
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error('API request failed');
        const data = await response.json();
        if (data.response_code !== 0) throw new Error('Invalid API response');
        questions = data.results.map(q => ({
          question: decodeHTML(q.question),
          options: [...q.incorrect_answers, q.correct_answer]
            .map(decodeHTML)
            .sort(() => Math.random() - 0.5), // Shuffle options
          correct_answer: decodeHTML(q.correct_answer)
        }));
      } catch (error) {
        console.error('Error fetching questions:', error);
        questionText.textContent = 'Failed to load questions. Please try again.';
        loadingScreen.classList.add('hidden');
        quizContent.classList.remove('hidden');
        submitBtn.disabled = true;
      }
    }

    // Decode HTML entities
    function decodeHTML(html) {
      const txt = document.createElement('textarea');
      txt.innerHTML = html;
      return txt.value;
    }

    // Start Quiz
    async function startQuiz() {
      startScreen.classList.add('hidden');
      quizScreen.classList.remove('hidden');
      resultsScreen.classList.add('hidden');
      reviewModal.classList.add('hidden');
      currentQuestionIndex = 0;
      score = 0;
      userAnswers = [];
      scoreDisplay.textContent = '0';
      await fetchQuestions();
      if (questions.length > 0) {
        loadingScreen.classList.add('hidden');
        quizContent.classList.remove('hidden');
        displayQuestion();
      }
    }

    // Display Current Question
    function displayQuestion() {
      if (currentQuestionIndex >= questions.length) {
        showResults();
        return;
      }
      const q = questions[currentQuestionIndex];
      questionNumber.textContent = currentQuestionIndex + 1;
      questionText.textContent = q.question;
      optionsContainer.innerHTML = '';
      q.options.forEach(option => {
        const label = document.createElement('label');
        label.className = 'block p-3 bg-gray-700 rounded-lg hover:bg-gray-600 transition duration-200 cursor-pointer flex items-center';
        label.innerHTML = `
          <input type="radio" name="answer" value="${option}" class="mr-3 text-blue-500 focus:ring-blue-500">
          <span>${option}</span>
        `;
        optionsContainer.appendChild(label);
      });
      progressBar.style.width = `${((currentQuestionIndex + 1) / questions.length) * 100}%`;
      startTimer();
    }

    // Start Timer
    function startTimer() {
      timeLeft = 15;
      timerDisplay.textContent = timeLeft;
      clearInterval(timer);
      timer = setInterval(() => {
        timeLeft--;
        timerDisplay.textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(timer);
          userAnswers.push({ questionIndex: currentQuestionIndex, selected: null });
          new Audio('https://freesound.org/data/previews/156/156031_2828628-lq.mp3').play();
          currentQuestionIndex++;
          displayQuestion();
        }
      }, 1000);
    }

    // Check Answer
    function checkAnswer() {
      const selected = document.querySelector('input[name="answer"]:checked');
      const selectedAnswer = selected ? selected.value : null;
      userAnswers.push({ questionIndex: currentQuestionIndex, selected: selectedAnswer });
      if (!selected) return;
      const answer = selected.value;
      const isCorrect = answer === questions[currentQuestionIndex].correct_answer;
      if (isCorrect) score++;
      const labels = optionsContainer.querySelectorAll('label');
      labels.forEach(label => {
        const input = label.querySelector('input');
        if (input.value === questions[currentQuestionIndex].correct_answer) {
          label.classList.add('correct');
          label.innerHTML = `<i class="fas fa-check-circle mr-3"></i>${label.innerText}`;
        } else if (input.checked && !isCorrect) {
          label.classList.add('incorrect');
          label.innerHTML = `<i class="fas fa-times-circle mr-3"></i>${label.innerText}`;
        }
      });
      submitBtn.disabled = true;
      clearInterval(timer);
      setTimeout(() => {
        submitBtn.disabled = false;
        currentQuestionIndex++;
        displayQuestion();
      }, 1000);
    }

    // Show Results with Score Animation
    function showResults() {
      quizScreen.classList.add('hidden');
      resultsScreen.classList.remove('hidden');
      animateScore(score);
      leaderboardPage = 0;
      saveHighScore(score);
      displayLeaderboard();
    }

    // Animate Score
    function animateScore(finalScore) {
      let currentScore = 0;
      const increment = Math.ceil(finalScore / 20); // Adjust for ~1s animation
      const scoreInterval = setInterval(() => {
        currentScore += increment;
        if (currentScore >= finalScore) {
          currentScore = finalScore;
          clearInterval(scoreInterval);
        }
        scoreDisplay.textContent = currentScore;
      }, 50);
    }

    // Save and Display Leaderboard
    function saveHighScore(score) {
      const highScores = JSON.parse(localStorage.getItem('highScores') || '[]');
      highScores.push({ score, date: new Date().toLocaleDateString() });
      highScores.sort((a, b) => b.score - a.score);
      localStorage.setItem('highScores', JSON.stringify(highScores.slice(0, 10))); // Top 10
    }

    function displayLeaderboard() {
      const highScores = JSON.parse(localStorage.getItem('highScores') || '[]');
      leaderboardContent.innerHTML = '';
      if (highScores.length === 0) {
        leaderboardContent.innerHTML = '<p class="text-gray-400">No scores yet!</p>';
        prevPage.disabled = true;
        nextPage.disabled = true;
        return;
      }
      const start = leaderboardPage * scoresPerPage;
      const end = start + scoresPerPage;
      highScores.slice(start, end).forEach((entry, index) => {
        leaderboardContent.innerHTML += `
          <p class="flex items-center">
            <i class="fas fa-medal mr-2 text-yellow-400"></i>
            ${start + index + 1}. Score: ${entry.score}/10 - ${entry.date}
          </p>
        `;
      });
      prevPage.disabled = leaderboardPage === 0;
      nextPage.disabled = end >= highScores.length;
    }

    // Display Review Modal
    function showReview() {
      reviewModal.classList.remove('hidden');
      reviewContent.innerHTML = '';
      if (userAnswers.length === 0) {
        reviewContent.innerHTML = '<p class="text-gray-400">No answers to review!</p>';
        return;
      }
      userAnswers.forEach((answer, index) => {
        const q = questions[answer.questionIndex];
        const isCorrect = answer.selected === q.correct_answer;
        const isSkipped = answer.selected === null;
        const div = document.createElement('div');
        div.className = 'p-3 bg-gray-700 rounded-lg';
        div.innerHTML = `
          <p class="font-medium mb-2"><i class="fas fa-question-circle mr-2"></i>${q.question}</p>
          <p class="${isSkipped ? 'text-gray-400' : isCorrect ? 'text-green-400' : 'text-red-400'}">
            <i class="${isSkipped ? 'fas fa-forward' : isCorrect ? 'fas fa-check-circle' : 'fas fa-times-circle'} mr-2"></i>
            Your Answer: ${answer.selected || 'Skipped'}
          </p>
          <p class="text-green-400"><i class="fas fa-check-circle mr-2"></i>Correct Answer: ${q.correct_answer}</p>
        `;
        reviewContent.appendChild(div);
      });
    }

    // Pagination Event Listeners
    prevPage.addEventListener('click', () => {
      if (leaderboardPage > 0) {
        leaderboardPage--;
        displayLeaderboard();
      }
    });
    nextPage.addEventListener('click', () => {
      const highScores = JSON.parse(localStorage.getItem('highScores') || '[]');
      if ((leaderboardPage + 1) * scoresPerPage < highScores.length) {
        leaderboardPage++;
        displayLeaderboard();
      }
    });

    // Event Listeners
    startBtn.addEventListener('click', startQuiz);
    submitBtn.addEventListener('click', checkAnswer);
    retryBtn.addEventListener('click', startQuiz);
    reviewBtn.addEventListener('click', showReview);
    closeReview.addEventListener('click', () => reviewModal.classList.add('hidden'));
  </script>
</body>
  </html>
